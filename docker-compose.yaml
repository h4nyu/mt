version: '2.4'

x-env: &env
  CODECOV_TOKEN: &CODECOV_TOKEN ${CODECOV_TOKEN}

  # internal
  DATABASE_URL: postgres://app:app@db/app


x-app: &app
  image: "kaguya-dev"
  build:
    context: .
  volumes:
    - .:/app


services:
  app:
    <<: *app
    environment:
      CODECOV_TOKEN: *CODECOV_TOKEN

  db:
    image: "timescale/timescaledb:latest-pg13"
    environment:
      POSTGRES_PASSWORD: app
      POSTGRES_USER: app
